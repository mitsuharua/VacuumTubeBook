# fittingプログラム

このディレクトリには，三極真空管のEp-Ip特性を実測したデータに対して，Cohen-Helieモデルを当てはめて，LTspiceのモデルデータを出力するプログラムと，サンプルファイルが入っています．

# このディレクトリにあるファイル

* README.md: このファイル
* CSVtoModel_Cohen_Helie.py: Python3による変換プログラム
* 6J1_Eg2=Ep.csv: 三極管結合でEg1とEpを決めてIpを実測したデータ
* 6J1_params_Cohen.csv: モデルフィッティングする際のパラメータの初期化ファイル

# プログラムの実行方法

python3 CSVtoModel_Cohen_Helie.py 6J1_Eg2=Ep.csv 6J1_params_Cohen.csv

# プログラムの実行に必要なライブラリ

標準ライブラリ以外にlmfitが必要です．
pip3 install lmfit
でインストールしてください．

# 入力ファイル

* 6J1_Eg2=Ep.csv
ファイル名は「真空管名_コメント.csv」と付けています．
6行目からの縦軸がプレート電圧です．これは好きな値を書くことができます．列の数を増やしたり減らしたりできます．
5行目の横軸がグリッドのバイアス電圧です．これは好きな値を書くことができます．列の数を増やしたり減らしたりできます．
グリッドのバイアス電圧とプレート電圧を書いた行と列に対して，全ての計測値を埋める必要があります．

* 6J1_params_Cohem.csv
非線形最小二乗法でデータにグラフをフィッティングする際のパラメータの初期値です．各行は
パラメータ名,初期値,最小値,最大値,
となっています．初期値から始めて，最小値と最大値の間でデータに最もフィットするようなパラメータを探します．出力されたグラフで，うまくデータにフィットしたモデルが出力されない場合は，これらの値を変えてみてください．

# 出力ファイル

* 6J1_Eg2=ep_Cohen.pdf: 計測データとフィットした曲線の両方をプロットしたグラフ
* 6J1_Eg2=ep_Cohen.sub: 出力されたLTspiceで使用できるモデルファイル
* 6J1_Eg2=ep_Original.pdf: 計測データのグラフ(最大値は全ての値が入る値)
* 6J1_Eg2=ep_Original1mA.pdf: 計測データのグラフ(最大値は1mA)
* 6J1_Eg2=ep_Original3D.pdf: 計測データのEp-Eg-Ip特性グラフを，3次元で表現したものです．各EgとEpに対するIpの値をプロットするので，EgとEpの値を底面とするIpのグラフは3次元で表現されます．
